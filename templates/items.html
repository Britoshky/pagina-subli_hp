{% extends 'base.html' %}
{% block title %}Lista de {{ category|capitalize }}{% endblock %}
{% block content %}

<h1>Lista de {{ category|capitalize }}</h1>

<!-- Filtros -->
<div class="search-container">
    <input type="text" id="search-input" placeholder="Buscar..." value="{{ search_query }}"
        oninput="filterItems('{{ category }}')">
    <div class="filter-container">
        <label for="filter-select">Filtrar por:</label>
        <select id="filter-select" onchange="applyFilter('{{ category }}')">
            <option value="todos" {% if filter_option=='todos' %}selected{% endif %}>Todos</option>
            <option value="vendidos" {% if filter_option=='vendidos' %}selected{% endif %}>Vendidos</option>
            <option value="en-stock" {% if filter_option=='en-stock' %}selected{% endif %}>En stock</option>
        </select>
    </div>
    <br>
    <!-- Bot√≥n de reiniciar -->
    <div class="reset-container">
        <button id="open-modal-btn" class="btn reset" data-category="{{ category }}">Reiniciar Stock</button>
    </div>


    <div class="stock-metrics">
        <div class="metric-card total">
            <p class="metric-title">Total de {{ category|capitalize }}</p>
            <p class="metric-value">{{ total_types }}</p>
        </div>
        <div class="metric-card in-stock">
            <p class="metric-title">Total en Stock</p>
            <p class="metric-value">{{ total_in_stock_units }}</p>
        </div>
        <div class="metric-card out-of-stock">
            <p class="metric-title">Fuera de Stock</p>
            <p class="metric-value">{{ total_out_of_stock_types }}</p>
        </div>
    </div>
            
    <!-- Modal de confirmaci√≥n -->
    <div id="confirmation-modal" class="hidden modal">
        <div class="modal-content">
            <h2>¬øEst√°s seguro?</h2>
            <p>Esta acci√≥n reiniciar√° el stock de todos los productos de esta categor√≠a a 0.</p>
            <div class="modal-actions">
                <button id="confirm-reset-btn" class="btn confirm">S√≠, reiniciar</button>
                <button id="cancel-modal-btn" class="btn cancel">Cancelar</button>
            </div>
        </div>
    </div>
</div>

<!-- Lista de elementos -->
<div class="item-list">
    <table>
        <thead>
            <tr>
                <th>#</th>
                <th>Imagen</th>
                <th>Nombre</th>
                <th>Stock</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody id="item-list-body">
            {% for item in items %}
            <tr class="item-row {% if item.quantity == 0 %}out-of-stock{% endif %}">
                <td>{{ (page - 1) * 10 + loop.index }}</td>
                <td>
                    {% if item.image_filename %}
                    <img src="/static/uploads/{{ category }}/{{ item.image_filename }}" alt="{{ item.name }}">
                    {% endif %}
                </td>
                <td class="item-name">{{ item.name }}</td>
                <td>
                    <div class="stock-actions">
                        <a href="{{ url_for(category + '.update_stock', item_id=item.id, action='add', page=page, search=search_query, filter=filter_option) }}"
                            class="btn add">+</a>
                        <span class="stock-quantity">{{ item.quantity }}</span>
                        <a href="{{ url_for(category + '.update_stock', item_id=item.id, action='subtract', page=page, search=search_query, filter=filter_option) }}"
                            class="btn subtract">-</a>
                    </div>
                </td>
                <td>
                    <div class="actions">
                        <a href="{{ url_for(category + '.edit_item', item_id=item.id) }}" class="btn edit">‚úé Editar</a>
                        <a href="{{ url_for(category + '.delete_item', item_id=item.id, page=page, search=search_query, filter=filter_option) }}" class="btn delete"
                            onclick="return confirm('¬øEst√°s seguro de que deseas eliminar este {{ category }}?')">üóë
                            Eliminar</a>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Paginaci√≥n -->
<div class="pagination">
    {% if page > 1 %}
    <a href="{{ url_for(category + '.list_items', page=page-1, search=search_query, filter=filter_option) }}">&laquo;
        Anterior</a>
    {% endif %}

    {% for p in pagination %}
    {% if p == '...' %}
    <span>...</span>
    {% else %}
    <a href="{{ url_for(category + '.list_items', page=p, search=search_query, filter=filter_option) }}"
        class="{{ 'active' if p == page else '' }}">{{ p }}</a>
    {% endif %}
    {% endfor %}

    {% if page < total_pages %} <a
        href="{{ url_for(category + '.list_items', page=page+1, search=search_query, filter=filter_option) }}">
        Siguiente &raquo;</a>
        {% endif %}
</div>

<!-- Bot√≥n flotante para agregar elementos -->
<a href="{{ url_for(category + '.add_item') }}" class="floating-add-button">+</a>

<!-- Importar el archivo JavaScript -->
<script src="/static/js/search.js"></script>
<script src="/static/js/modalConfirmation.js"></script>


<style>
    /* Contenedor de b√∫squeda */
    .search-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin: 20px 0;
    }

    /* Campo de b√∫squeda */
    #search-input {
        width: 80%;
        max-width: 500px;
        padding: 10px;
        border: 2px solid #eb6abe;
        border-radius: 5px;
        font-size: 16px;
        margin-bottom: 15px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    /* Contenedor del filtro */
    .filter-container {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
    }

    /* Etiqueta del filtro */
    .filter-container label {
        font-size: 16px;
        font-weight: bold;
        color: #eb6abe;
    }

    /* Select del filtro */
    .filter-container select {
        padding: 8px;
        border: 2px solid #eb6abe;
        border-radius: 5px;
        font-size: 16px;
        background-color: #fff;
        color: #333;
    }

    /* Hover en select */
    .filter-container select:hover {
        border-color: #ae6aeb;
    }

    .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        /* El modal ser√° visible si no tiene la clase `hidden` */
        justify-content: center;
        align-items: center;
        z-index: 1000;
    }

    .hidden {
        display: none;
    }


    .modal-content {
        background: white;
        padding: 20px;
        border-radius: 8px;
        text-align: center;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        max-width: 400px;
        width: 100%;
    }

    .modal-actions {
        margin-top: 20px;
        display: flex;
        justify-content: space-around;
    }

    .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        font-size: 16px;
        cursor: pointer;
    }

    .btn.reset {
        background-color: #eb6abe;
        color: white;
        transition: background-color 0.3s;
    }

    .btn.reset:hover {
        background-color: #846aeb;
    }

    .btn.confirm {
        background-color: #d96aeb;
        color: white;
    }

    .btn.cancel {
        background-color: #846aeb;
        color: white;
    }

    .btn:hover {
        opacity: 0.9;
    }
</style>

{% endblock %}